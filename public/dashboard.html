<!DOCTYPE html>
<head>
    <title>Dashboard</title>
    <meta name="author" content="Youliang Liu">
    <script src="/jquery/jquery.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-auth.js"></script>
    <script src="/w2ui-1.5.rc1/w2ui-1.5.rc1.js"></script>
    <link rel="stylesheet" href="/w2ui-1.5.rc1/w2ui-1.5.rc1.css">
</head>
<body>
    <nav>
        <a href="/reports/speed.html">Speed Data</a> |
        <a href="/reports/browsers.html">Browser Data</a> |
        <a href="./logout.html">Logout</a>
    </nav>
    <p>List of People who accessed the site</p>
    <div id="grid" style="height: 450px"></div>

    <script>
        var adminArray = [];
        $('#grid').w2grid({
            name: 'grid',
            header: 'List of People who accessed the site',
            show: {
                toolbar: true,
                footer: true
            },
            columns: [
                { field: 'name', caption: 'Name', size: '40%', sortable: true, resizable: true },
                { field: 'email', caption: 'Email', size: '40%', resizable: true },
                { field: 'verified', caption: 'Verified', size: '20%', resizable: true },
            ],
            searches: [
                { field: 'name', caption: 'Name', type: 'text' },
            ],
            sortData: [
                { field: 'name', direction: 'ASC' }
            ],
            records: []
        })
        function requestAdmins(){
            var request = new XMLHttpRequest();
            var url = 'https://us-central1-cse135-hw4-5666d.cloudfunctions.net/returnListOfAdmins';
            request.open('POST', url, true);
            request.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var responseObj = JSON.parse(this.response);
                    adminArray = responseObj.array;
                    for (i = 0; i<adminArray.length; i++) {
                        w2ui['grid'].add({ recid: i+1, name: adminArray[i].name, email: adminArray[i].email, verified: adminArray[i].verified });
                    }
                }
            };
            request.send('request');
        }
        requestAdmins();
    </script>
</body>